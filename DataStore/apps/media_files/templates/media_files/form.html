{% extends 'base.html' %}

{% block title %}Upload Media - DataStore{% endblock %}

{% block breadcrumb %}
<a href="{% url 'project_list' %}" class="breadcrumb-item">Projects</a>
<span class="breadcrumb-separator">/</span>
<a href="{% url 'project_detail' event.project.pk %}" class="breadcrumb-item">{{ event.project.name }}</a>
<span class="breadcrumb-separator">/</span>
<a href="{% url 'event_detail' event.pk %}" class="breadcrumb-item">{{ event.title }}</a>
<span class="breadcrumb-separator">/</span>
<span class="breadcrumb-item active">Upload Media</span>
{% endblock %}

{% block content %}
<div class="animate-fade-in-up" style="max-width: 600px;">
    <!-- Form Header -->
    <div class="page-header">
        <div class="page-title">
            <div class="page-title-icon"
                style="background: linear-gradient(135deg, var(--color-success) 0%, var(--color-accent) 100%);">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div>
                <h1>Upload Media</h1>
                <p class="text-muted mb-0">
                    <i class="fas fa-calendar-day me-1"></i>
                    For: {{ event.title }}
                </p>
            </div>
        </div>
    </div>

    <!-- Form Card -->
    <div class="card">
        <div class="card-body">
            <form method="POST" enctype="multipart/form-data" id="uploadForm">
                {% csrf_token %}

                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-file me-1"></i>
                        Select File *
                    </label>
                    <div class="file-upload" id="dropZone">
                        <input type="file" name="file" id="fileInput" required>
                        <div class="file-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p class="file-upload-text mb-2">
                            <span>Click to upload</span> or drag and drop
                        </p>
                        <p class="text-muted small mb-0">
                            Supports images, documents, videos, and other files
                        </p>
                        <div id="filePreview" class="mt-3" style="display: none;">
                            <div class="badge badge-success">
                                <i class="fas fa-check-circle me-1"></i>
                                <span id="fileName"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <hr>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-success" id="uploadBtn">
                        <i class="fas fa-upload"></i>
                        Upload File
                    </button>
                    <a href="{% url 'event_detail' event.pk %}" class="btn btn-secondary">
                        <i class="fas fa-times"></i>
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Supported Formats Info -->
    <div class="card mt-4">
        <div class="card-body">
            <h5 class="mb-3">
                <i class="fas fa-info-circle text-primary me-2"></i>
                Supported File Types
            </h5>
            <div class="d-flex gap-4" style="flex-wrap: wrap;">
                <div class="d-flex align-items-center gap-2">
                    <span class="badge badge-info"><i class="fas fa-image"></i></span>
                    <span class="small">Images (JPG, PNG, GIF)</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <span class="badge badge-danger"><i class="fas fa-file-pdf"></i></span>
                    <span class="small">PDF Documents</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <span class="badge badge-primary"><i class="fas fa-file-word"></i></span>
                    <span class="small">Word Documents</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <span class="badge badge-success"><i class="fas fa-file-excel"></i></span>
                    <span class="small">Excel Spreadsheets</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <span class="badge badge-secondary"><i class="fas fa-file-video"></i></span>
                    <span class="small">Video Files</span>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_scripts %}
<script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const filePreview = document.getElementById('filePreview');
    const fileName = document.getElementById('fileName');

    // Drag and drop handling
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => {
            dropZone.classList.add('drag-over');
        }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => {
            dropZone.classList.remove('drag-over');
        }, false);
    });

    dropZone.addEventListener('drop', (e) => {
        const files = e.dataTransfer.files;
        if (files.length) {
            fileInput.files = files;
            showFilePreview(files[0]);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length) {
            showFilePreview(e.target.files[0]);
        }
    });

    function showFilePreview(file) {
        fileName.textContent = file.name;
        filePreview.style.display = 'block';
    }
</script>
{% endblock %}
{% endblock %}